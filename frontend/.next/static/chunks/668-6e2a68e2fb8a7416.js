(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[668],{8750:function(e,t,a){"use strict";a.d(t,{Z:function(){return i}});var r=a(5893),l=a(7294),c=a(1664),n=a.n(c);let s=()=>{let[e,t]=(0,l.useState)([]),[a,r]=(0,l.useState)(!0),c=(0,l.useCallback)(()=>{try{let e=localStorage.getItem("cart");if(e){let a=JSON.parse(e);Array.isArray(a)?t(a):(console.warn("Некорректные данные корзины в localStorage, сброс до пустой корзины."),t([]),localStorage.removeItem("cart"))}}catch(e){console.error("Ошибка при загрузке корзины из localStorage:",e),t([])}finally{r(!1)}},[]),n=(0,l.useCallback)(e=>{try{localStorage.setItem("cart",JSON.stringify(e)),window.dispatchEvent(new StorageEvent("cart_update",{key:"cart",newValue:JSON.stringify(e)}))}catch(e){console.error("Ошибка при сохранении корзины в localStorage:",e)}},[]);(0,l.useEffect)(()=>{c();let e=e=>{if("cart"===e.key&&"cart_update"===e.type||"cart"===e.key&&"storage"===e.type)try{let a=e.newValue;if(null===a)t([]);else{let e=JSON.parse(a);Array.isArray(e)&&t(e)}}catch(e){console.error("Ошибка при обновлении корзины из StorageEvent:",e)}};return window.addEventListener("cart_update",e),window.addEventListener("storage",e),()=>{window.removeEventListener("cart_update",e),window.removeEventListener("storage",e)}},[c]);let s=(0,l.useCallback)(e=>{"function"==typeof e?t(t=>{let a=e(t);return n(a),a}):(t(e),n(e))},[n]),i=(0,l.useCallback)(e=>{s(t=>{let a;let r=t.findIndex(t=>t.id===e.id);return r>=0?(a=[...t])[r]={...a[r],quantity:a[r].quantity+1}:a=[...t,{...e,quantity:1}],a})},[s]),o=(0,l.useCallback)(e=>{s(t=>t.filter(t=>t.id!==e))},[s]),d=(0,l.useCallback)((e,t)=>{if(t<=0){o(e);return}s(a=>a.map(a=>a.id===e?{...a,quantity:t}:a))},[o,s]),u=(0,l.useCallback)(()=>{s([])},[s]),m=(0,l.useCallback)(()=>e.reduce((e,t)=>e+t.quantity,0),[e]),f=(0,l.useCallback)(()=>e.reduce((e,t)=>e+t.price*t.quantity,0),[e]);return{cartItems:e,isLoading:a,addToCart:i,removeFromCart:o,updateQuantity:d,clearCart:u,getTotalItems:m,getTotalPrice:f,loadCart:c}};var i=e=>{let{product:t}=e,{addToCart:a}=s();return(0,r.jsxs)("div",{className:"product-card fade-in",children:[t.image?(0,r.jsx)("div",{className:"w-full h-48 overflow-hidden",children:(0,r.jsx)("img",{src:t.image,alt:t.name,className:"w-full h-full object-cover transition duration-500 ease-in-out transform hover:scale-105",onError:e=>{e.target.src="/images/placeholder-product.jpg"}})}):(0,r.jsx)("div",{className:"w-full h-48 bg-gray-200 flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-gray-500",children:"Изображение отсутствует"})}),(0,r.jsxs)("div",{className:"p-4",children:[(0,r.jsx)("h3",{className:"text-lg font-serif font-bold text-chocolate mb-1",children:t.name}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-2 line-clamp-2",children:t.description}),(0,r.jsxs)("div",{className:"flex justify-between items-center mt-3",children:[(0,r.jsxs)("span",{className:"text-xl font-bold text-chocolate",children:["от ",t.price.toLocaleString("ru-RU")," ₽"]}),(0,r.jsx)("button",{onClick:()=>{let e=Date.now();a({id:e,productId:t.id,name:t.name,price:t.price,image:t.image}),console.log("Добавлен товар ".concat(t.name," в корзину с ID элемента ").concat(e))},className:"btn-primary text-sm py-1 px-3","aria-label":"Добавить ".concat(t.name," в корзину"),children:"В корзину"})]}),(0,r.jsx)(n(),{href:"/product/".concat(t.id),className:"text-mint hover:text-chocolate text-sm font-medium mt-2 inline-block",children:"Подробнее →"})]})]})}},9008:function(e,t,a){e.exports=a(3867)}}]);