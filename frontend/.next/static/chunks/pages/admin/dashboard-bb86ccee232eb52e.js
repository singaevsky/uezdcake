(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[189],{2599:function(e,s,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/dashboard",function(){return a(4991)}])},4991:function(e,s,a){"use strict";a.r(s);var t=a(5893),d=a(7294),l=a(3148),i=a(6495),r=a(2336);l.kL.register(l.uw,l.f$,l.od,l.jn,l.ZL,l.qi,l.Dx,l.u,l.De),s.default=()=>{let[e,s]=(0,d.useState)([]),[a,l]=(0,d.useState)([]),[o,n]=(0,d.useState)(null),[c,h]=(0,d.useState)([]),[x,m]=(0,d.useState)(!0);(0,d.useEffect)(()=>{if(!r.k.isAuthenticated()){window.location.href="/login";return}g()},[]);let g=async()=>{try{let e=await fetch("/api/admin/dashboard/stats/",{headers:{Authorization:"Bearer ".concat(r.k.getAccessToken())}});if(!e.ok)throw Error("Failed to fetch dashboard data");let a=await e.json();s(a.recent_orders),l(a.top_products),n(a.stats),h(a.order_statuses)}catch(e){console.error("Error loading dashboard data:",e)}finally{m(!1)}},u={labels:e.map(e=>new Date(e.date).toLocaleDateString("ru-RU")),datasets:[{label:"Выручка (₽)",data:e.map(e=>e.revenue),borderColor:"#6B4423",backgroundColor:"rgba(107, 68, 35, 0.1)",tension:.4,fill:!0}]},p={labels:e.map(e=>new Date(e.date).toLocaleDateString("ru-RU")),datasets:[{label:"Количество заказов",data:e.map(e=>e.orders_count),backgroundColor:"#FADADD",borderColor:"#F87171",borderWidth:1}]},b={labels:c.map(e=>({new:"Новые",processing:"В обработке",baking:"Готовятся",ready:"Готовы",delivered:"Доставлены",cancelled:"Отменены"})[e.status]||e.status),datasets:[{data:c.map(e=>e.count),backgroundColor:["#3B82F6","#F59E0B","#EF4444","#10B981","#8B5CF6","#6B7280"],borderWidth:2,borderColor:"#FFFFFF"}]};return x?(0,t.jsx)("div",{className:"min-h-screen bg-cream flex items-center justify-center",children:(0,t.jsx)("div",{className:"text-2xl",children:"Загрузка..."})}):(0,t.jsx)("div",{className:"min-h-screen bg-cream",children:(0,t.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,t.jsx)("h1",{className:"text-3xl font-serif mb-8",children:"Админ-панель"}),o&&(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[(0,t.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,t.jsx)("div",{className:"text-3xl font-bold text-chocolate",children:o.total}),(0,t.jsx)("div",{className:"text-gray-600",children:"Всего клиентов"})]}),(0,t.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,t.jsx)("div",{className:"text-3xl font-bold text-chocolate",children:o.new_last_30_days}),(0,t.jsx)("div",{className:"text-gray-600",children:"Новых за 30 дней"})]}),(0,t.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,t.jsx)("div",{className:"text-3xl font-bold text-chocolate",children:o.active_last_90_days}),(0,t.jsx)("div",{className:"text-gray-600",children:"Активных за 90 дней"})]}),(0,t.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,t.jsxs)("div",{className:"text-3xl font-bold text-chocolate",children:[e.reduce((e,s)=>e+s.revenue,0).toLocaleString("ru-RU")," ₽"]}),(0,t.jsx)("div",{className:"text-gray-600",children:"Выручка за 30 дней"})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8",children:[(0,t.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:(0,t.jsx)(i.x1,{data:u,options:{responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:"Выручка за 30 дней"}},scales:{y:{beginAtZero:!0,ticks:{callback:function(e){return e.toLocaleString("ru-RU")+" ₽"}}}}}})}),(0,t.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:(0,t.jsx)(i.$Q,{data:p,options:{responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:"Заказы за 30 дней"}},scales:{y:{beginAtZero:!0,ticks:{stepSize:1}}}}})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,t.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:(0,t.jsx)(i.by,{data:b,options:{responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:"Статусы заказов"}}}})}),(0,t.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,t.jsx)("h2",{className:"text-xl font-serif mb-4",children:"Топ продуктов"}),(0,t.jsx)("div",{className:"space-y-4",children:a.map((e,s)=>(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-semibold",children:e.name}),(0,t.jsxs)("div",{className:"text-sm text-gray-600",children:["Продано: ",e.sold," шт."]})]}),(0,t.jsxs)("div",{className:"text-chocolate font-bold",children:[e.revenue.toLocaleString("ru-RU")," ₽"]})]},s))})]})]})]})})}}},function(e){e.O(0,[196,421,888,774,179],function(){return e(e.s=2599)}),_N_E=e.O()}]);