"use strict";(()=>{var e={};e.id=189,e.ids=[189,888,660],e.modules={1323:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,s){return s in t?t[s]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,s)):"function"==typeof t&&"default"===s?t:void 0}}})},6896:(e,t,s)=>{s.a(e,async(e,a)=>{try{s.r(t),s.d(t,{config:()=>x,default:()=>h,getServerSideProps:()=>g,getStaticPaths:()=>p,getStaticProps:()=>m,reportWebVitals:()=>b,routeModule:()=>w,unstable_getServerProps:()=>P,unstable_getServerSideProps:()=>S,unstable_getStaticParams:()=>j,unstable_getStaticPaths:()=>f,unstable_getStaticProps:()=>v});var r=s(7093),i=s(5244),l=s(1323),d=s(2899),o=s.n(d),n=s(6814),c=s(1261),u=e([n,c]);[n,c]=u.then?(await u)():u;let h=(0,l.l)(c,"default"),m=(0,l.l)(c,"getStaticProps"),p=(0,l.l)(c,"getStaticPaths"),g=(0,l.l)(c,"getServerSideProps"),x=(0,l.l)(c,"config"),b=(0,l.l)(c,"reportWebVitals"),v=(0,l.l)(c,"unstable_getStaticProps"),f=(0,l.l)(c,"unstable_getStaticPaths"),j=(0,l.l)(c,"unstable_getStaticParams"),P=(0,l.l)(c,"unstable_getServerProps"),S=(0,l.l)(c,"unstable_getServerSideProps"),w=new r.PagesRouteModule({definition:{kind:i.x.PAGES,page:"/admin/dashboard",pathname:"/admin/dashboard",bundlePath:"",filename:""},components:{App:n.default,Document:o()},userland:c});a()}catch(e){a(e)}})},1261:(e,t,s)=>{s.a(e,async(e,a)=>{try{s.r(t),s.d(t,{default:()=>c});var r=s(997),i=s(6689),l=s(3767),d=s(2189),o=s(3673),n=e([l,d,o]);[l,d,o]=n.then?(await n)():n,l.Chart.register(l.CategoryScale,l.LinearScale,l.PointElement,l.LineElement,l.BarElement,l.ArcElement,l.Title,l.Tooltip,l.Legend);let c=()=>{let[e,t]=(0,i.useState)([]),[s,a]=(0,i.useState)([]),[l,n]=(0,i.useState)(null),[c,u]=(0,i.useState)([]),[h,m]=(0,i.useState)(!0);(0,i.useEffect)(()=>{if(!o.k.isAuthenticated()){window.location.href="/login";return}p()},[]);let p=async()=>{try{let e=await fetch("/api/admin/dashboard/stats/",{headers:{Authorization:`Bearer ${o.k.getAccessToken()}`}});if(!e.ok)throw Error("Failed to fetch dashboard data");let s=await e.json();t(s.recent_orders),a(s.top_products),n(s.stats),u(s.order_statuses)}catch(e){console.error("Error loading dashboard data:",e)}finally{m(!1)}},g={labels:e.map(e=>new Date(e.date).toLocaleDateString("ru-RU")),datasets:[{label:"Выручка (₽)",data:e.map(e=>e.revenue),borderColor:"#6B4423",backgroundColor:"rgba(107, 68, 35, 0.1)",tension:.4,fill:!0}]},x={labels:e.map(e=>new Date(e.date).toLocaleDateString("ru-RU")),datasets:[{label:"Количество заказов",data:e.map(e=>e.orders_count),backgroundColor:"#FADADD",borderColor:"#F87171",borderWidth:1}]},b={labels:c.map(e=>({new:"Новые",processing:"В обработке",baking:"Готовятся",ready:"Готовы",delivered:"Доставлены",cancelled:"Отменены"})[e.status]||e.status),datasets:[{data:c.map(e=>e.count),backgroundColor:["#3B82F6","#F59E0B","#EF4444","#10B981","#8B5CF6","#6B7280"],borderWidth:2,borderColor:"#FFFFFF"}]};return h?r.jsx("div",{className:"min-h-screen bg-cream flex items-center justify-center",children:r.jsx("div",{className:"text-2xl",children:"Загрузка..."})}):r.jsx("div",{className:"min-h-screen bg-cream",children:(0,r.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[r.jsx("h1",{className:"text-3xl font-serif mb-8",children:"Админ-панель"}),l&&(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[r.jsx("div",{className:"text-3xl font-bold text-chocolate",children:l.total}),r.jsx("div",{className:"text-gray-600",children:"Всего клиентов"})]}),(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[r.jsx("div",{className:"text-3xl font-bold text-chocolate",children:l.new_last_30_days}),r.jsx("div",{className:"text-gray-600",children:"Новых за 30 дней"})]}),(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[r.jsx("div",{className:"text-3xl font-bold text-chocolate",children:l.active_last_90_days}),r.jsx("div",{className:"text-gray-600",children:"Активных за 90 дней"})]}),(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,r.jsxs)("div",{className:"text-3xl font-bold text-chocolate",children:[e.reduce((e,t)=>e+t.revenue,0).toLocaleString("ru-RU")," ₽"]}),r.jsx("div",{className:"text-gray-600",children:"Выручка за 30 дней"})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8",children:[r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-md",children:r.jsx(d.Line,{data:g,options:{responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:"Выручка за 30 дней"}},scales:{y:{beginAtZero:!0,ticks:{callback:function(e){return e.toLocaleString("ru-RU")+" ₽"}}}}}})}),r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-md",children:r.jsx(d.Bar,{data:x,options:{responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:"Заказы за 30 дней"}},scales:{y:{beginAtZero:!0,ticks:{stepSize:1}}}}})})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-md",children:r.jsx(d.Pie,{data:b,options:{responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:"Статусы заказов"}}}})}),(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[r.jsx("h2",{className:"text-xl font-serif mb-4",children:"Топ продуктов"}),r.jsx("div",{className:"space-y-4",children:s.map((e,t)=>(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[r.jsx("div",{className:"font-semibold",children:e.name}),(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:["Продано: ",e.sold," шт."]})]}),(0,r.jsxs)("div",{className:"text-chocolate font-bold",children:[e.revenue.toLocaleString("ru-RU")," ₽"]})]},t))})]})]})]})})};a()}catch(e){a(e)}})},5244:(e,t)=>{var s;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return s}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(s||(s={}))},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},6162:e=>{e.exports=require("stream")},1568:e=>{e.exports=require("zlib")},9648:e=>{e.exports=import("axios")},3767:e=>{e.exports=import("chart.js")},2189:e=>{e.exports=import("react-chartjs-2")}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[567,424,899,814],()=>s(6896));module.exports=a})();