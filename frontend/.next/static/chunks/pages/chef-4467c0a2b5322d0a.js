(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[526],{8189:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chef",function(){return s(4179)}])},4179:function(e,t,s){"use strict";s.r(t);var n=s(5893),a=s(7294),r=s(1163),l=s(2336);t.default=()=>{let[e,t]=(0,a.useState)([]),[s,i]=(0,a.useState)(!0),[c,d]=(0,a.useState)(null),o=(0,r.useRouter)();(0,a.useEffect)(()=>{if(!l.k.isAuthenticated()){o.push("/login");return}let e=l.k.getCurrentUser();if((null==e?void 0:e.role)!=="chef"){o.push("/");return}x();let s=new WebSocket("ws://localhost:8000/ws");return s.onopen=()=>{console.log("WebSocket connected")},s.onmessage=e=>{let s=JSON.parse(e.data);"new_order"===s.type?x():"status_updated"===s.type&&t(e=>e.map(e=>e.id===s.order_id?{...e,status:s.status}:e))},s.onclose=()=>{console.log("WebSocket disconnected")},d(s),()=>{s&&s.close()}},[]);let x=async()=>{try{let e=await fetch("/api/orders/chef/"),s=await e.json();t(s)}catch(e){console.error("Error loading orders:",e)}finally{i(!1)}},u=async(e,t)=>{c&&c.readyState===WebSocket.OPEN&&c.send(JSON.stringify({type:"status_update",order_id:e,status:t}))},g=e=>({new:"bg-blue-100 text-blue-800",processing:"bg-yellow-100 text-yellow-800",baking:"bg-orange-100 text-orange-800",ready:"bg-green-100 text-green-800",delivered:"bg-purple-100 text-purple-800",cancelled:"bg-red-100 text-red-800"})[e]||"bg-gray-100 text-gray-800";return s?(0,n.jsx)("div",{className:"min-h-screen bg-cream flex items-center justify-center",children:(0,n.jsx)("div",{className:"text-2xl",children:"Загрузка..."})}):(0,n.jsx)("div",{className:"min-h-screen bg-cream",children:(0,n.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,n.jsx)("h1",{className:"text-3xl font-serif",children:"Панель кондитера"}),(0,n.jsx)("div",{className:"text-right",children:(0,n.jsxs)("div",{className:"text-lg",children:["Активных заказов: ",e.length]})})]}),0===e.length?(0,n.jsxs)("div",{className:"text-center py-16",children:[(0,n.jsx)("div",{className:"text-6xl mb-4",children:"\uD83C\uDF70"}),(0,n.jsx)("h2",{className:"text-2xl font-serif mb-2",children:"Нет активных заказов"}),(0,n.jsx)("p",{className:"text-gray-600",children:"Новые заказы появятся здесь автоматически"})]}):(0,n.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:e.map(e=>(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,n.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("h3",{className:"text-xl font-bold",children:["Заказ #",e.id]}),(0,n.jsx)("p",{className:"text-gray-600",children:e.user.username})]}),(0,n.jsxs)("span",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat(g(e.status)),children:["new"===e.status&&"Новый","processing"===e.status&&"В обработке","baking"===e.status&&"Готовится","ready"===e.status&&"Готов","delivered"===e.status&&"Доставлен","cancelled"===e.status&&"Отменён"]})]}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsxs)("p",{className:"text-2xl font-bold text-chocolate",children:[e.total_price," ₽"]}),(0,n.jsxs)("p",{className:"text-sm text-gray-600",children:["Доставка: ",new Date(e.delivery_date).toLocaleDateString()]})]}),(0,n.jsxs)("div",{className:"flex flex-wrap gap-2",children:["new"===e.status&&(0,n.jsx)("button",{onClick:()=>u(e.id,"processing"),className:"bg-yellow-500 text-white px-3 py-1 rounded text-sm hover:bg-yellow-600 transition",children:"Взять в работу"}),"processing"===e.status&&(0,n.jsx)("button",{onClick:()=>u(e.id,"baking"),className:"bg-orange-500 text-white px-3 py-1 rounded text-sm hover:bg-orange-600 transition",children:"Начать готовить"}),"baking"===e.status&&(0,n.jsx)("button",{onClick:()=>u(e.id,"ready"),className:"bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600 transition",children:"Готов"}),("new"===e.status||"processing"===e.status||"baking"===e.status)&&(0,n.jsx)("button",{onClick:()=>u(e.id,"cancelled"),className:"bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600 transition",children:"Отменить"})]})]},e.id))})]})})}}},function(e){e.O(0,[888,774,179],function(){return e(e.s=8189)}),_N_E=e.O()}]);